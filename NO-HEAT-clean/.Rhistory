hot_3 = case_when(
hi_max >= 100 ~ 1,
TRUE ~ 0
))
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, date, as.Date(NA)),
date_prior = ifelse(hot_1 == rainy_day, NA, as.character(hot_1_date - 7)),
date_after = ifelse(hot_1 == rainy_day, NA, as.character(hot_1_date + 7))
)
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, date, as.Date(NA))
# date_prior = ifelse(hot_1 == rainy_day, NA, as.character(hot_1_date - 7)),
# date_after = ifelse(hot_1 == rainy_day, NA, as.character(hot_1_date + 7))
)
View(days_hot_1_2019)
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, date, as.Date(NA)),
date_prior = ifelse(hot_1 == rainy_day, NA_character_, as.character(hot_1_date - 7)),
date_after = ifelse(hot_1 == rainy_day, NA_character_, as.character(hot_1_date + 7))
)
View(days_hot_1_2019)
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, date, as.Date(NA)),
date_prior = ifelse(hot_1 == rainy_day, as.Date(NA), hot_1_date - 7),
date_after = ifelse(hot_1 == rainy_day, as.Date(NA), hot_1_date + 7)
)
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.Date(date), as.Date(NA)),
date_prior = ifelse(hot_1 == rainy_day, as.Date(NA), as.Date(hot_1_date - 7)),
date_after = ifelse(hot_1 == rainy_day, as.Date(NA), as.Date(hot_1_date + 7))
)
View(days_hot_1_2019)
###########################################################################################################
#Script Metadata
#Created by: Hajra Shahab
#About:
#  --
#Version Log:
#  --HS- 09/02/2025--
#Output:
# --
#Files Output:
###########################################################################################################
# Clear R environment every time you run a new batch
rm(list = ls())
# Load required libraries
liby <- c("sqldf", "ggplot2", "rstudioapi", "questionr", "tidyverse", "dplyr", "here")
lapply(liby, require, character.only = TRUE)
# Set working directory
here::i_am("NO_HEAT_TAXI_TNC.Rproj")
# Option settings
options(scipen = 100000)
options(sqldf.driver = "SQLite")
theme_set(theme_bw())
############################################################################################################
#read heat index files from heat_index analysis
hot_days_2018 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2018_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2019_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2023 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2023_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2024 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2024_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2025 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2025_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019$date <- as.Date(hot_days_2019$date)
hot_days_2019$day_of_week <- weekdays(hot_days_2019$date)
#filter weekends
hot_days_2019_select_days <- hot_days_2019[!(hot_days_2019$day_of_week %in% c('Saturday', 'Sunday')),]
#define hot days categories
days_hot_2019 <- hot_days_2019_select_days %>%
filter(!rainy_day == 1) %>%
mutate(
hot_1 = case_when(
hi_max >= hi_max.90perc & hi_max >= 80 ~ 1,
TRUE ~ 0
),
hot_2 = case_when(
hi_max >= 90 ~ 1,
TRUE ~ 0
),
hot_3 = case_when(
hi_max >= 100 ~ 1,
TRUE ~ 0
))
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.Date(date), as.Date(NA)),
date_prior = ifelse(hot_1 == rainy_day, as.Date(NA), as.Date(hot_1_date - 7)),
date_after = ifelse(hot_1 == rainy_day, as.Date(NA), as.Date(hot_1_date + 7))
)
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), as.character(NA)),
date_prior = ifelse(hot_1 == rainy_day, as.character(NA), as.character(hot_1_date - 7)),
date_after = ifelse(hot_1 == rainy_day, as.character(NA), as.character(hot_1_date + 7))
)
View(days_hot_1_2019)
###########################################################################################################
#Script Metadata
#Created by: Hajra Shahab
#About:
#  --
#Version Log:
#  --HS- 09/02/2025--
#Output:
# --
#Files Output:
###########################################################################################################
# Clear R environment every time you run a new batch
rm(list = ls())
# Load required libraries
liby <- c("sqldf", "ggplot2", "rstudioapi", "questionr", "tidyverse", "dplyr", "here")
lapply(liby, require, character.only = TRUE)
# Set working directory
here::i_am("NO_HEAT_TAXI_TNC.Rproj")
# Option settings
options(scipen = 100000)
options(sqldf.driver = "SQLite")
theme_set(theme_bw())
############################################################################################################
#read heat index files from heat_index analysis
hot_days_2018 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2018_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2019_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2023 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2023_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2024 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2024_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2025 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2025_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019$date <- as.Date(hot_days_2019$date)
hot_days_2019$day_of_week <- weekdays(hot_days_2019$date)
#filter weekends
hot_days_2019_select_days <- hot_days_2019[!(hot_days_2019$day_of_week %in% c('Saturday', 'Sunday')),]
#define hot days categories
days_hot_2019 <- hot_days_2019_select_days %>%
filter(!rainy_day == 1) %>%
mutate(
hot_1 = case_when(
hi_max >= hi_max.90perc & hi_max >= 80 ~ 1,
TRUE ~ 0
),
hot_2 = case_when(
hi_max >= 90 ~ 1,
TRUE ~ 0
),
hot_3 = case_when(
hi_max >= 100 ~ 1,
TRUE ~ 0
))
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), as.character(NA)),
date_prior = ifelse(hot_1 == rainy_day, as.character(NA), as.character(hot_1_date - 7)),
date_after = ifelse(hot_1 == rainy_day, as.character(NA), as.character(hot_1_date + 7))
)
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.Date(date), as.character(NA)),
date_prior = ifelse(hot_1 == rainy_day, as.character(NA), as.Date(hot_1_date - 7)),
date_after = ifelse(hot_1 == rainy_day, as.character(NA), as.Date(hot_1_date + 7))
)
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = ifelse(date %in% rainy_day, NA_character_, as.character(as.Date(hot_1_date) - 7)),
date_after = ifelse(date %in% rainy_day, NA_character_, as.character(as.Date(hot_1_date) + 7))
)
###########################################################################################################
#Script Metadata
#Created by: Hajra Shahab
#About:
#  --
#Version Log:
#  --HS- 09/02/2025--
#Output:
# --
#Files Output:
###########################################################################################################
# Clear R environment every time you run a new batch
rm(list = ls())
# Load required libraries
liby <- c("sqldf", "ggplot2", "rstudioapi", "questionr", "tidyverse", "dplyr", "here")
lapply(liby, require, character.only = TRUE)
# Set working directory
here::i_am("NO_HEAT_TAXI_TNC.Rproj")
# Option settings
options(scipen = 100000)
options(sqldf.driver = "SQLite")
theme_set(theme_bw())
############################################################################################################
#read heat index files from heat_index analysis
hot_days_2018 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2018_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2019_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2023 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2023_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2024 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2024_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2025 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2025_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019$date <- as.Date(hot_days_2019$date)
hot_days_2019$day_of_week <- weekdays(hot_days_2019$date)
#filter weekends
hot_days_2019_select_days <- hot_days_2019[!(hot_days_2019$day_of_week %in% c('Saturday', 'Sunday')),]
#define hot days categories
days_hot_2019 <- hot_days_2019_select_days %>%
filter(!rainy_day == 1) %>%
mutate(
hot_1 = case_when(
hi_max >= hi_max.90perc & hi_max >= 80 ~ 1,
TRUE ~ 0
),
hot_2 = case_when(
hi_max >= 90 ~ 1,
TRUE ~ 0
),
hot_3 = case_when(
hi_max >= 100 ~ 1,
TRUE ~ 0
))
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = ifelse(date %in% rainy_day, NA_character_, as.character(as.Date(hot_1_date) - 7)),
date_after = ifelse(date %in% rainy_day, NA_character_, as.character(as.Date(hot_1_date) + 7))
)
View(days_hot_1_2019)
rainy_day <- as.Date("2019-07-22", "2019-07-23")
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = ifelse(date %in% rainy_day, NA_character_, as.character(hot_1_date) - 7),
date_after = ifelse(date %in% rainy_day, NA_character_, as.character(hot_1_date) + 7)
)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = ifelse(date %in% rainy_day, NA_character_, as.character(hot_1_date) - 7),
date_after = ifelse(date %in% rainy_day, NA_character_, as.character(hot_1_date) + 7)
)
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = ifelse(date %in% rainy_day, NA_character_, as.Date(hot_1_date) - 7),
date_after = ifelse(date %in% rainy_day, NA_character_, as.Date(hot_1_date) + 7)
)
View(days_hot_1_2019)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = ifelse(date %in% rainy_day, NA_character_, as.character(hot_1_date) - 7),
date_after = ifelse(date %in% rainy_day, NA_character_, as.character(hot_1_date) + 7)
)
View(days_hot_1_2019)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, date, as.Date(NA)),  # keep as Date
date_prior = ifelse(date %in% rainy_day, as.Date(NA), hot_1_date - 7),
date_after = ifelse(date %in% rainy_day, as.Date(NA), hot_1_date + 7)
)
View(days_hot_1_2019)
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = ifelse(date %in% rainy_day, NA_character_, as.character(hot_1_date) - 7),
date_after = ifelse(date %in% rainy_day, NA_character_, as.character(hot_1_date) + 7)
)
View(days_hot_1_2019)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = ifelse(date %in% rainy_day, NA_character_, as.character(as.Date(hot_1_date) - 7)),
date_after = ifelse(date %in% rainy_day, NA_character_, as.character(as.Date(hot_1_date) + 7))
)
View(days_hot_1_2019)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = as.character(as.Date(hot_1_date) - 7),
date_after = as.character(as.Date(hot_1_date) + 7)
)
View(days_hot_1_2019)
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = as.character(as.Date(hot_1_date) - 7),
date_after = as.character(as.Date(hot_1_date) + 7)
)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, NA, date_prior)
View(days_hot_1_2019)
hot_days_2018 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2018_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2019_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2023 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2023_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2024 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2024_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2025 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2025_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019$date <- as.Date(hot_days_2019$date)
hot_days_2019$day_of_week <- weekdays(hot_days_2019$date)
#filter weekends
hot_days_2019_select_days <- hot_days_2019[!(hot_days_2019$day_of_week %in% c('Saturday', 'Sunday')),]
#define hot days categories
days_hot_2019 <- hot_days_2019_select_days %>%
filter(!rainy_day == 1) %>%
mutate(
hot_1 = case_when(
hi_max >= hi_max.90perc & hi_max >= 80 ~ 1,
TRUE ~ 0
),
hot_2 = case_when(
hi_max >= 90 ~ 1,
TRUE ~ 0
),
hot_3 = case_when(
hi_max >= 100 ~ 1,
TRUE ~ 0
))
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = as.character(as.Date(hot_1_date) - 7),
date_after = as.character(as.Date(hot_1_date) + 7)
)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, NA, date_prior)
View(days_hot_2019)
View(days_hot_2019)
View(hot_days_2019_select_days)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.character(date), NA_character_),
date_prior = as.Date(hot_1_date) - 7,
date_after = as.Date(hot_1_date) + 7
)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, NA, date_prior)
View(days_hot_1_2019)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.Date(date), NA_character_),
date_prior = as.Date(hot_1_date) - 7,
date_after = as.Date(hot_1_date) + 7
)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.Date(date), NA),
date_prior = as.Date(hot_1_date) - 7,
date_after = as.Date(hot_1_date) + 7
)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.Date(date), as.Date(NA)),
date_prior = as.Date(hot_1_date) - 7,
date_after = as.Date(hot_1_date) + 7
)
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = ifelse(hot_1 == 1, as.Date(date), as.Date(NA)),
date_prior = as.Date(hot_1_date) - 7,
date_after = as.Date(hot_1_date) + 7
)
View(days_hot_1_2019)
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = if_else(hot_1 == 1, date, as.Date(NA)),   # preserves Date class
date_prior = hot_1_date - 7,
date_after = hot_1_date + 7
)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, NA, date_prior)
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = if_else(hot_1 == 1, date, as.Date(NA)),   # preserves Date class
date_prior = hot_1_date - 7,
date_after = hot_1_date + 7
)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, NA, date_prior)
###########################################################################################################
#Script Metadata
#Created by: Hajra Shahab
#About:
#  --
#Version Log:
#  --HS- 09/02/2025--
#Output:
# --
#Files Output:
###########################################################################################################
# Clear R environment every time you run a new batch
rm(list = ls())
# Load required libraries
liby <- c("sqldf", "ggplot2", "rstudioapi", "questionr", "tidyverse", "dplyr", "here")
lapply(liby, require, character.only = TRUE)
# Set working directory
here::i_am("NO_HEAT_TAXI_TNC.Rproj")
# Option settings
options(scipen = 100000)
options(sqldf.driver = "SQLite")
theme_set(theme_bw())
############################################################################################################
#read heat index files from heat_index analysis
hot_days_2018 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2018_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2019_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2023 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2023_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2024 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2024_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2025 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2025_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019$date <- as.Date(hot_days_2019$date)
hot_days_2019$day_of_week <- weekdays(hot_days_2019$date)
#filter weekends
hot_days_2019_select_days <- hot_days_2019[!(hot_days_2019$day_of_week %in% c('Saturday', 'Sunday')),]
#define hot days categories
days_hot_2019 <- hot_days_2019_select_days %>%
filter(!rainy_day == 1) %>%
mutate(
hot_1 = case_when(
hi_max >= hi_max.90perc & hi_max >= 80 ~ 1,
TRUE ~ 0
),
hot_2 = case_when(
hi_max >= 90 ~ 1,
TRUE ~ 0
),
hot_3 = case_when(
hi_max >= 100 ~ 1,
TRUE ~ 0
))
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = if_else(hot_1 == 1, date, as.Date(NA)),   # preserves Date class
date_prior = hot_1_date - 7,
date_after = hot_1_date + 7
)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, NA, date_prior)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, as.Date(NA), date_prior)
###########################################################################################################
#Script Metadata
#Created by: Hajra Shahab
#About:
#  --
#Version Log:
#  --HS- 09/02/2025--
#Output:
# --
#Files Output:
###########################################################################################################
# Clear R environment every time you run a new batch
rm(list = ls())
# Load required libraries
liby <- c("sqldf", "ggplot2", "rstudioapi", "questionr", "tidyverse", "dplyr", "here")
lapply(liby, require, character.only = TRUE)
# Set working directory
here::i_am("NO_HEAT_TAXI_TNC.Rproj")
# Option settings
options(scipen = 100000)
options(sqldf.driver = "SQLite")
theme_set(theme_bw())
############################################################################################################
#read heat index files from heat_index analysis
hot_days_2018 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2018_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2019_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2023 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2023_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2024 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2024_2025-09-02.csv"), stringsAsFactors = FALSE)
#hot_days_2025 <- read.csv(here("Processed Data", "heat_index", "daily_combined_data_HI_precipitation_2025_2025-09-02.csv"), stringsAsFactors = FALSE)
hot_days_2019$date <- as.Date(hot_days_2019$date)
hot_days_2019$day_of_week <- weekdays(hot_days_2019$date)
#filter weekends
hot_days_2019_select_days <- hot_days_2019[!(hot_days_2019$day_of_week %in% c('Saturday', 'Sunday')),]
#define hot days categories
days_hot_2019 <- hot_days_2019_select_days %>%
filter(!rainy_day == 1) %>%
mutate(
hot_1 = case_when(
hi_max >= hi_max.90perc & hi_max >= 80 ~ 1,
TRUE ~ 0
),
hot_2 = case_when(
hi_max >= 90 ~ 1,
TRUE ~ 0
),
hot_3 = case_when(
hi_max >= 100 ~ 1,
TRUE ~ 0
))
rainy_day <- as.Date(c("2019-07-22", "2019-07-23"))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date = if_else(hot_1 == 1, date, as.Date(NA)),   # preserves Date class
date_prior = hot_1_date - 7,
date_after = hot_1_date + 7
)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, as.Date(NA), date_prior)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, as.character(NA), as.character(date_prior))
days_hot_1_2019 <- days_hot_2019 %>%
mutate(
hot_1_date  = if_else(hot_1 == 1, date, as.Date(NA)),
date_prior  = if_else(hot_1_date %in% rainy_day, NA_Date_, hot_1_date - 7),
date_after  = if_else(hot_1_date %in% rainy_day, NA_Date_, hot_1_date + 7),
date_prior  = as.character(date_prior),
date_after  = as.character(date_after)
)
days_hot_1_2019$date_prior = if_else(date_prior %in% rainy_day, as.character(NA), as.character(date_prior))
